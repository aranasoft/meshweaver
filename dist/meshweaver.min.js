(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};this.Meshweaver||(this.Meshweaver={}),t={saveExistingOnChange:!0},this.Meshweaver.ValidatedView=function(){function i(i,n){this.setStateToError=e(this.setStateToError,this),this.setStateToSuccess=e(this.setStateToSuccess,this),this.setStateToSaving=e(this.setStateToSaving,this),this.clearStatus=e(this.clearStatus,this),this.setStatusRowClass=e(this.setStatusRowClass,this),this.ensureValidationSummaryItem=e(this.ensureValidationSummaryItem,this),this.clearInputs=e(this.clearInputs,this),this.modelFromInputs=e(this.modelFromInputs,this),this.inputChanged=e(this.inputChanged,this),this.persistModel=e(this.persistModel,this),this.onValidated=e(this.onValidated,this),this.unconfigureValidation=e(this.unconfigureValidation,this),this.configureValidation=e(this.configureValidation,this),this.self=i,this.options=_.extend({},t,n),this.statusRowClass=".row-status"}return i.prototype.bindUIElements=function(){this._bindUIElements(),this._bindUIErrorElements(),_.invoke(this._behaviors,this._bindUIElements),_.invoke(this._behaviors,this._bindUIErrorElements)},i.prototype._bindUIErrorElements=function(){var t;this.uiError&&(this._uiErrorBindings||(this._uiErrorBindings=this.uiError),t=_.result(this,"_uiErrorBindings"),this.uiError={},_.each(t,function(t,e){this.uiError[e]=this.$(t)},this))},i.prototype.unbindUIElements=function(){this._unbindUIElements(),this._unbindUIErrorElements(),_.invoke(this._behaviors,this._unbindUIElements),_.invoke(this._behaviors,this._unbindUIErrorElements)},i.prototype._unbindUIErrorElements=function(){this.uiError&&this._uiErrorBindings&&(_.each(this.uiError,function(t,e){delete this.uiError[e]},this),this.uiError=this._uiErrorBindings,delete this._uiErrorBindings)},i.prototype.configureValidation=function(){var t,e,i,n;Meshweaver.Validation.bind(this.self,{valid:function(t){return function(e,i){var n,r,a,s;return s=(null!=(r=e.uiError)?r[i]:void 0)||(null!=(a=e.ui)?a[i]:void 0),null!=s?(s&&s.toggleClass("input-validation-error",!1),n=t.ensureValidationSummaryItem(i),n.toggleClass("hide",!0)):void 0}}(this),invalid:function(t){return function(e,i,n){var r,a,s,u;return u=(null!=(a=e.uiError)?a[i]:void 0)||(null!=(s=e.ui)?s[i]:void 0),null!=u?(u&&u.toggleClass("input-validation-error",!0),r=t.ensureValidationSummaryItem(i,n),r.toggleClass("hide",!1)):void 0}}(this)}),i=this.self.ui,n=[];for(e in i)t=i[e],t.hasClass("input-date")&&t.on("change",this.inputChanged),t.hasClass("input-date")||t.on("blur",this.inputChanged),n.push(t.on("keypress",this.inputChangedCheck));return n},i.prototype.unconfigureValidation=function(){return Meshweaver.Validation.unbind(this.self)},i.prototype.onValidated=function(t,e,i){var n,r;return n=this.self.$(".validation-summary").first(),r=!t&&$("ul > li",n).not(".hide").length>0,n.toggleClass("validation-summary-valid",!r),n.toggleClass("validation-summary-errors",r)},i.prototype.persistModel=function(){var t;return t=this.self.model.changedAttributes(),t&&this.self.model.isValid(!0)?(this.setStateToSaving(),this.self.model.save(null,{error:function(t){return function(e,i,n){return t.setStateToError(i.responseJSON)}}(this),success:function(e){return function(){var i,n,r,a;if(e.setStateToSuccess(),e.self.changeEventsOn){r=[];for(n in t)a=t[n],i=_(e.self.changeEventsOn).any(function(t){return t===n}),i?r.push(e.self.model.trigger("change:"+n,e.self.model)):r.push(void 0);return r}}}(this),silent:!0})):void 0},i.prototype.inputChangedCheck=function(t){var e;if("textarea"!==t.target.tagName.toLowerCase()&&(e=t.keyCode?t.keyCode:t.which,13===e))return this.inputChanged(t)},i.prototype.inputChanged=function(t){var e,i,n,r;return this.self.model.set(this.modelFromInputs()),this.self.trigger("input-change",t),!this.self.model.isNew()&&this.options.saveExistingOnChange?void this.persistModel():(e=function(e){return $(t.currentTarget).is(e)},n=function(t){return _.any(t[1],e)},(i=_.chain(this.self.ui).pairs().filter(n).first().value())?(r={},r[i[0]]=this.valueFromInput(i[1]),this.self.model.validate(r)):void 0)},i.prototype.modelFromInputs=function(){var t,e,i;this.proposedModel={},e=this.self.ui;for(t in e)i=e[t],this.proposedModel[t]=this.valueFromInput(i);return this.proposedModel},i.prototype.valueFromInput=function(t){var e,i,n;return e=t.is(":radio")?t.filter(":checked"):t,n=e.val(),""===n?void 0:e.hasClass("input-date")?moment(n).utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]"):e.hasClass("input-numeric")||t.is("input[type=number]")?(!isNaN(parseFloat(n))&&isFinite(n)&&(i=Number(n)),null==i&&(i=Number.NaN),i):n},i.prototype.clearInputs=function(){var t,e,i,n;e=this.self.ui,i=[];for(t in e)n=e[t],i.push(n.val(""));return i},i.prototype.ensureValidationSummaryItem=function(t,e){var i,n;return n=this.self.$(".validation-summary").first(),i=$("ul",n).find("."+t),i.length||(i=$(document.createElement("li")).addClass(t).addClass("hide").appendTo($("ul",n))),i.text(e?e:""),i},i.prototype.rowSuccessTemplate=_.template('<div class="alert alert-fixed alert-success alert-thin fade in"><span class="icon-stack"><i class="icon-circle-blank icon-stack-base"></i><i class="icon-thumbs-up"></i></span> <%= data.text %></div>'),i.prototype.rowInfoTemplate=_.template('<div class="alert alert-fixed alert-info alert-thin fade in"><%= data.text %></div>'),i.prototype.rowErrorTemplate=_.template('<div class="alert alert-error alert-thin fade in"><%= data.text %></div>'),i.prototype.setStatusRowClass=function(t){return this.statusRowClass=t},i.prototype.clearStatus=function(){return this.self.$(this.statusRowClass+" .alert").alert("close")},i.prototype.setStateToSaving=function(){return this.self.$(this.statusRowClass).html(this.rowInfoTemplate({data:{text:"Saving"}}))},i.prototype.setStateToSuccess=function(){return this.self.$(this.statusRowClass).html(this.rowSuccessTemplate({data:{text:"Successfully Saved"}})),setTimeout(this.clearStatus,3e3)},i.prototype.setStateToError=function(t){var e,i;return t||(t={}),i=t.modelState||(t.modelState=[]),_.each(i,function(t){return function(e,i){var n,r;return e||(e=[]),null!=e[0]&&(r=_.result(t.self.ui,i),null!=r)?(r.toggleClass("input-validation-error",!0),n=t.ensureValidationSummaryItem(i,e[0]),n.toggleClass("hide",!1)):void 0}}(this)),e=this.self.$(".validation-summary").first(),e.toggleClass("validation-summary-valid",!1),e.toggleClass("validation-summary-errors",!0),this},i}()}).call(this),function(){this.Meshweaver||(this.Meshweaver={}),this.Meshweaver.Validation=function(t){var e,i,n,r,a,s,u,o,l,d;return s={forceUpdate:!1,selector:"name",labelFormatter:"label",valid:Function.prototype,invalid:Function.prototype},d={formatLabel:function(t,e){return r[s.labelFormatter](t,e)},format:function(){var t,e;return t=Array.prototype.slice.call(arguments),e=t.shift(),e.replace(/\{(\d+)\}/g,function(e,i){return"undefined"!=typeof t[i]?t[i]:e})}},l=function(e,i,n){return i=i||{},n=n||"",t.each(e,function(r,a){e.hasOwnProperty(a)&&(r&&t.isArray(r)?t.forEach(r,function(t,e){l(t,i,n+a+"."+e+"."),i[n+a+"."+e]=t}):r&&"object"==typeof r&&r.constructor===Object&&l(r,i,n+a+"."),i[n+a]=r)}),i},e=function(){var e,r,a,u,c,h,F,f,m,v;return c=function(e,i){return i=i||t.keys(t.result(e,"validation")||{}),t.reduce(i,function(t,e){return t[e]=void 0,t},{})},u=function(e,n){var r;return r=e.attributes,t.isFunction(r)?r=r(n):t.isString(r)&&t.isFunction(i[r])&&(r=i[r](n)),t.isArray(r)?r:void 0},h=function(e,i){var n;return n=e.validation?t.result(e,"validation")[i]||{}:{},(t.isFunction(n)||t.isString(n))&&(n={fn:n}),t.isArray(n)||(n=[n]),t.reduce(n,function(e,i){return t.each(t.without(t.keys(i),"msg"),function(t){e.push({fn:o[t],val:i[t],msg:i.msg})}),e},[])},m=function(e,i,n,r){return t.reduce(h(e,i),function(a,s){var u,l;return u=t.extend({},d,o),l=s.fn.call(u,n,i,s.val,e,r,s.msg),l===!1||a===!1?!1:l&&!a?l:a},"")},v=function(e,i,n){var r,a,s,u;return a=void 0,s={},u=!0,r=t.clone(i),t.each(n,function(t,i){a=m(e,i,t,r),a&&(s[i]=a,u=!1)}),{invalidAttrs:s,isValid:u}},F=function(e,i){return{preValidate:function(e,i){var n,r,a;return a=this,r={},n=void 0,t.isObject(e)?(t.each(e,function(t,e){n=a.preValidate(e,t),n&&(r[e]=n)}),t.isEmpty(r)?void 0:r):m(this,e,i,t.extend({},this.attributes))},isValid:function(n){var r,a,s,o;return s=void 0,r=void 0,a=void 0,o=void 0,n=n||u(i,e),t.isString(n)?r=[n]:t.isArray(n)&&(r=n),r&&(s=l(this.attributes),t.each(this.associatedViews,function(e){t.each(r,function(n){a=m(this,n,s[n],t.extend({},this.attributes)),a?(i.invalid(e,n,a,i.selector),o=o||{},o[n]=a):i.valid(e,n,i.selector)},this)},this)),n===!0&&(o=this.validate()),o&&this.trigger("invalid",this,o,{validationError:o}),r?!o:this.validation?this._isValid:!0},validate:function(n,r){var a,s,o,d,h,F,f,m;return d=this,f=!n,h=t.extend({},i,r),m=c(d,u(i,e)),a=t.extend({},m,d.attributes,n),o=l(a),s=n?l(n):o,F=v(d,a,t.pick(o,t.keys(m))),d._isValid=F.isValid,t.each(d.associatedViews,function(e){t.each(m,function(t,i){var n,r;r=F.invalidAttrs.hasOwnProperty(i),n=s.hasOwnProperty(i),r||h.valid(e,i,h.selector),r&&(n||f)&&h.invalid(e,i,F.invalidAttrs[i],h.selector)})}),t.defer(function(){d.trigger("validated",d._isValid,d,F.invalidAttrs),d.trigger("validated:"+(d._isValid?"valid":"invalid"),d,F.invalidAttrs)}),!h.forceUpdate&&t.intersection(t.keys(F.invalidAttrs),t.keys(s)).length>0?F.invalidAttrs:void 0}}},e=function(e,i,n){i.associatedViews?i.associatedViews.push(e):i.associatedViews=[e],t.extend(i,F(e,n))},f=function(e,i){i&&e.associatedViews&&e.associatedViews.length>1?e.associatedViews=t.without(e.associatedViews,i):(delete e.validate,delete e.preValidate,delete e.isValid,delete e.associatedViews)},r=function(t){e(this.view,t,this.options)},a=function(t){f(t)},{version:"0.3.0",configure:function(e){t.extend(s,e)},bind:function(i,u){var o,l;if(u=t.extend({},s,n,u),l=u.model||i.model,o=u.collection||i.collection,"undefined"==typeof l&&"undefined"==typeof o)throw new Error("Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.");l?e(i,l,u):o&&(o.each(function(t){e(i,t,u)}),o.bind("add",r,{view:i,options:u}),o.bind("remove",a))},unbind:function(e,i){var n,s;i=t.extend({},i),s=i.model||e.model,n=i.collection||e.collection,s?f(s,e):n&&(n.each(function(t){f(t,e)}),n.unbind("add",r),n.unbind("remove",a))},mixin:F(null,s)}}(),n=e.callbacks={valid:function(t,e,i){t.$("["+i+'~="'+e+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,e,i,n){t.$("["+n+'~="'+e+'"]').addClass("invalid").attr("data-error",i)}},u=e.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},a=e.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",notEqualTo:"{0} must not be the same as {1}",validCollection:"{0} contains invalid entries: {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},r=e.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return 0===e?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(e,i){var n,r;return n=t.isFunction(i.labels)?i.labels.call(i):i.labels,r=Meshweaver.Validation.labelFormatters.sentenceCase,t.result(n,e)||r(e,i)}},i=e.attributeLoaders={inputNames:function(t){var e;return e=[],t.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===e.indexOf(this.name)&&e.push(this.name)}),e}},o=e.validators=function(){var e,i,n;return n=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){var e,i;return e=/^\s+/,i=/\s+$/,null===t?"":t.toString().replace(e,"").replace(i,"")},i=function(e){return t.isNumber(e)||t.isString(e)&&e.match(u.number)},e=function(e){return null==e?!1:t.isString(e)&&!e?!1:t.isArray(e)&&t.isEmpty(e)?!1:!0},{fn:function(e,i,n,r,a,s){return t.isString(n)&&(n=r[n]),n.call(r,e,i,a,s)},required:function(i,n,r,s,u,o){var l;return l=t.isFunction(r)?r.call(s,i,n,u):r,l||e(i)?l&&!e(i)?this.format(o||a.required,this.formatLabel(n,s)):void 0:!1},acceptance:function(e,i,n,r,s,u){return"true"===e||t.isBoolean(e)&&e===!0?void 0:this.format(u||a.acceptance,this.formatLabel(i,r))},min:function(e,n,r,s,u,o){return r=t.isFunction(r)?r.call(s,e,n,u):r,i(e)&&e>=r?void 0:this.format(o||a.min,this.formatLabel(n,s),r)},max:function(e,n,r,s,u,o){return r=t.isFunction(r)?r.call(s,e,n,u):r,i(e)&&r>=e?void 0:this.format(o||a.max,this.formatLabel(n,s),r)},range:function(e,n,r,s,u,o){return r=t.isFunction(r)?r.call(s,e,n,u):r,i(e)&&e>=r[0]||e<=r[1]?void 0:this.format(o||a.range,this.formatLabel(n,s),r[0],r[1])},length:function(e,i,n,r,s,u){return n=t.isFunction(n)?n.call(r,e,i,s):n,t.isString(e)&&e.length===n?void 0:this.format(u||a.length,this.formatLabel(i,r),n)},minLength:function(e,i,n,r,s,u){return n=t.isFunction(n)?n.call(r,e,i,s):n,t.isString(e)&&e.length>=n?void 0:this.format(u||a.minLength,this.formatLabel(i,r),n)},maxLength:function(e,i,n,r,s,u){return n=t.isFunction(n)?n.call(r,e,i,s):n,t.isString(e)&&e.length<=n?void 0:this.format(u||a.maxLength,this.formatLabel(i,r),n)},rangeLength:function(e,i,n,r,s,u){return n=t.isFunction(n)?n.call(r,e,i,s):n,t.isString(e)&&e.length>=n[0]&&e.length<=n[1]?void 0:this.format(u||a.rangeLength,this.formatLabel(i,r),n[0],n[1])},oneOf:function(e,i,n,r,s,u){return t.include(n,e)?void 0:this.format(u||a.oneOf,this.formatLabel(i,r),n.join(", "))},equalTo:function(t,e,i,n,r,s){return t!==r[i]?(s||(s=a.equalTo),this.format(s,this.formatLabel(e,n),this.formatLabel(i,n))):void 0},notEqualTo:function(t,e,i,n,r,s){return t===r[i]?(s||(s=a.notEqualTo),this.format(s,this.formatLabel(e,n),this.formatLabel(i,n))):void 0},validCollection:function(e,i,n,r,s,u){var o,l,d;return d=t.isFunction(n)?n.call(r,e,i,s):n,d&&(l=t.chain(e.filter(function(t){return!t.isNew()})).map(function(t){return t.validate()}).value(),null!=t.find(l,function(t){return!!t}))?(o=t.chain(l).filter(function(t){return!!t}).map(function(e){return t.values(e)}).flatten().value().join("; "),this.format(u||a.validCollection,this.formatLabel(i,r),o)):void 0},pattern:function(i,n,r,s,o,l){return r=t.isFunction(r)?r.call(s,i,n,o):r,e(i)&&i.toString().match(u[r]||r)?void 0:(l||(l=a[r]||a.inlinePattern),this.format(l,this.formatLabel(n,s),r))}}}(),t.each(o,function(e,i){o[i]=t.bind(o[i],t.extend({},d,o))}),e}(_)}.call(this);
//# sourceMappingURL=meshweaver.min.js.map
