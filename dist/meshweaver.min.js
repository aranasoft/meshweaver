(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}};this.Meshweaver||(this.Meshweaver={}),this.Meshweaver.ValidatedView=function(){function i(i,e){this.setStateToError=t(this.setStateToError,this),this.setStateToSuccess=t(this.setStateToSuccess,this),this.setStateToSaving=t(this.setStateToSaving,this),this.clearStatus=t(this.clearStatus,this),this.setStatusRowClass=t(this.setStatusRowClass,this),this.ensureValidationSummaryItem=t(this.ensureValidationSummaryItem,this),this.clearInputs=t(this.clearInputs,this),this.modelFromInputs=t(this.modelFromInputs,this),this.inputChanged=t(this.inputChanged,this),this.persistModel=t(this.persistModel,this),this.onValidated=t(this.onValidated,this),this.unconfigureValidation=t(this.unconfigureValidation,this),this.configureValidation=t(this.configureValidation,this),this.self=i,e||(e={}),this.saveExistingOnChange=null!=e.saveExistingOnChange?e.saveExistingOnChange:e.saveExistingOnChange=!0,this.requireUiBinding=null!=e.requireUiBinding?e.requireUiBinding:e.requireUiBinding=!0,this.statusRowClass=".row-status"}return i.prototype.bindUIElements=function(){this._bindUIElements(),this._bindUIErrorElements(),_.invoke(this._behaviors,this._bindUIElements),_.invoke(this._behaviors,this._bindUIErrorElements)},i.prototype._bindUIErrorElements=function(){var t;this.uiError&&(this._uiErrorBindings||(this._uiErrorBindings=this.uiError),t=_.result(this,"_uiErrorBindings"),this.uiError={},_.each(t,function(t,i){this.uiError[i]=this.$(t)},this))},i.prototype.unbindUIElements=function(){this._unbindUIElements(),this._unbindUIErrorElements(),_.invoke(this._behaviors,this._unbindUIElements),_.invoke(this._behaviors,this._unbindUIErrorElements)},i.prototype._unbindUIErrorElements=function(){this.uiError&&this._uiErrorBindings&&(_.each(this.uiError,function(t,i){delete this.uiError[i]},this),this.uiError=this._uiErrorBindings,delete this._uiErrorBindings)},i.prototype.configureValidation=function(){var t,i,e,n;Meshweaver.Validation.bind(this.self,{valid:function(t){return function(i,e){var n,r,a,s;if(!t.requireUIBinding&&(s=(null!=(r=i.uiError)?r[e]:void 0)||(null!=(a=i.ui)?a[e]:void 0),null!=s))return s&&s.toggleClass("input-validation-error",!1),n=t.ensureValidationSummaryItem(e),n.toggleClass("hide",!0)}}(this),invalid:function(t){return function(i,e,n){var r,a,s,u;if(!t.requireUIBinding&&(u=(null!=(a=i.uiError)?a[e]:void 0)||(null!=(s=i.ui)?s[e]:void 0),null!=u))return u&&u.toggleClass("input-validation-error",!0),r=t.ensureValidationSummaryItem(e,n),r.toggleClass("hide",!1)}}(this)}),e=this.self.ui,n=[];for(i in e)t=e[i],t.hasClass("input-date")&&t.on("change",this.inputChanged),t.hasClass("input-date")||t.on("blur",this.inputChanged),n.push(t.on("keypress",this.inputChangedCheck));return n},i.prototype.unconfigureValidation=function(){return Meshweaver.Validation.unbind(this.self)},i.prototype.onValidated=function(t,i,e){var n,r;return n=this.self.$(".validation-summary").first(),r=!t&&$("ul > li",n).not(".hide").length>0,n.toggleClass("validation-summary-valid",!r),n.toggleClass("validation-summary-errors",r)},i.prototype.persistModel=function(){var t;return t=this.self.model.changedAttributes(),t&&this.self.model.isValid(!0)?(this.setStateToSaving(),this.self.model.save(null,{error:function(t){return function(i,e,n){return t.setStateToError(e.responseJSON)}}(this),success:function(i){return function(){var e,n,r,a;if(i.setStateToSuccess(),i.self.changeEventsOn){r=[];for(n in t)a=t[n],e=_(i.self.changeEventsOn).any(function(t){return t===n}),e?r.push(i.self.model.trigger("change:"+n,i.self.model)):r.push(void 0);return r}}}(this),silent:!0})):void 0},i.prototype.inputChangedCheck=function(t){var i;if("textarea"!==t.target.tagName.toLowerCase()&&(i=t.keyCode?t.keyCode:t.which,13===i))return this.inputChanged(t)},i.prototype.inputChanged=function(t){var i,e,n,r;return this.self.model.set(this.modelFromInputs()),this.self.trigger("input-change",t),!this.self.model.isNew()&&this.saveExistingOnChange?void this.persistModel():(i=function(i){return $(t.currentTarget).is(i)},n=function(t){return _.any(t[1],i)},(e=_.chain(this.self.ui).pairs().filter(n).first().value())?(r={},r[e[0]]=this.valueFromInput(e[1]),this.self.model.validate(r)):void 0)},i.prototype.modelFromInputs=function(){var t,i,e;this.proposedModel={},i=this.self.ui;for(t in i)e=i[t],this.proposedModel[t]=this.valueFromInput(e);return this.proposedModel},i.prototype.valueFromInput=function(t){var i,e,n;return i=t.is(":radio")?t.filter(":checked"):t,n=i.val(),""===n?void 0:i.hasClass("input-date")?moment(n).utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]"):i.hasClass("input-numeric")||t.is("input[type=number]")?(!isNaN(parseFloat(n))&&isFinite(n)&&(e=Number(n)),null==e&&(e=Number.NaN),e):n},i.prototype.clearInputs=function(){var t,i,e,n;i=this.self.ui,e=[];for(t in i)n=i[t],e.push(n.val(""));return e},i.prototype.ensureValidationSummaryItem=function(t,i){var e,n;return n=this.self.$(".validation-summary").first(),e=$("ul",n).find("."+t),e.length||(e=$(document.createElement("li")).addClass(t).addClass("hide").appendTo($("ul",n))),e.text(i?i:""),e},i.prototype.rowSuccessTemplate=_.template('<div class="alert alert-fixed alert-success alert-thin fade in"><span class="icon-stack"><i class="icon-circle-blank icon-stack-base"></i><i class="icon-thumbs-up"></i></span> <%= data.text %></div>'),i.prototype.rowInfoTemplate=_.template('<div class="alert alert-fixed alert-info alert-thin fade in"><%= data.text %></div>'),i.prototype.rowErrorTemplate=_.template('<div class="alert alert-error alert-thin fade in"><%= data.text %></div>'),i.prototype.setStatusRowClass=function(t){return this.statusRowClass=t},i.prototype.clearStatus=function(){return this.self.$(this.statusRowClass+" .alert").alert("close")},i.prototype.setStateToSaving=function(){return this.self.$(this.statusRowClass).html(this.rowInfoTemplate({data:{text:"Saving"}}))},i.prototype.setStateToSuccess=function(){return this.self.$(this.statusRowClass).html(this.rowSuccessTemplate({data:{text:"Successfully Saved"}})),setTimeout(this.clearStatus,3e3)},i.prototype.setStateToError=function(t){var i,e;return t||(t={}),e=t.modelState||(t.modelState=[]),_.each(e,function(t){return function(i,e){var n,r;return i||(i=[]),null!=i[0]&&(r=_.result(t.self.ui,e),null!=r)?(r.toggleClass("input-validation-error",!0),n=t.ensureValidationSummaryItem(e,i[0]),n.toggleClass("hide",!1)):void 0}}(this)),i=this.self.$(".validation-summary").first(),i.toggleClass("validation-summary-valid",!1),i.toggleClass("validation-summary-errors",!0),this},i}()}).call(this),function(){this.Meshweaver||(this.Meshweaver={}),this.Meshweaver.Validation=function(t){var i,e,n,r,a,s,u,o,l,d;return s={forceUpdate:!1,selector:"name",labelFormatter:"label",valid:Function.prototype,invalid:Function.prototype},d={formatLabel:function(t,i){return r[s.labelFormatter](t,i)},format:function(){var t,i;return t=Array.prototype.slice.call(arguments),i=t.shift(),i.replace(/\{(\d+)\}/g,function(i,e){return"undefined"!=typeof t[e]?t[e]:i})}},l=function(i,e,n){return e=e||{},n=n||"",t.each(i,function(r,a){i.hasOwnProperty(a)&&(r&&t.isArray(r)?t.forEach(r,function(t,i){l(t,e,n+a+"."+i+"."),e[n+a+"."+i]=t}):r&&"object"==typeof r&&r.constructor===Object&&l(r,e,n+a+"."),e[n+a]=r)}),e},i=function(){var i,r,a,u,c,h,F,f,m,v;return c=function(i,e){return e=e||t.keys(t.result(i,"validation")||{}),t.reduce(e,function(t,i){return t[i]=void 0,t},{})},u=function(i,n){var r;return r=i.attributes,t.isFunction(r)?r=r(n):t.isString(r)&&t.isFunction(e[r])&&(r=e[r](n)),t.isArray(r)?r:void 0},h=function(i,e){var n;return n=i.validation?t.result(i,"validation")[e]||{}:{},(t.isFunction(n)||t.isString(n))&&(n={fn:n}),t.isArray(n)||(n=[n]),t.reduce(n,function(i,e){return t.each(t.without(t.keys(e),"msg"),function(t){i.push({fn:o[t],val:e[t],msg:e.msg})}),i},[])},m=function(i,e,n,r){return t.reduce(h(i,e),function(a,s){var u,l;return u=t.extend({},d,o),l=s.fn.call(u,n,e,s.val,i,r,s.msg),l===!1||a===!1?!1:l&&!a?l:a},"")},v=function(i,e,n){var r,a,s,u;return a=void 0,s={},u=!0,r=t.clone(e),t.each(n,function(t,e){a=m(i,e,t,r),a&&(s[e]=a,u=!1)}),{invalidAttrs:s,isValid:u}},F=function(i,e){return{preValidate:function(i,e){var n,r,a;return a=this,r={},n=void 0,t.isObject(i)?(t.each(i,function(t,i){n=a.preValidate(i,t),n&&(r[i]=n)}),t.isEmpty(r)?void 0:r):m(this,i,e,t.extend({},this.attributes))},isValid:function(n){var r,a,s,o;return s=void 0,r=void 0,a=void 0,o=void 0,n=n||u(e,i),t.isString(n)?r=[n]:t.isArray(n)&&(r=n),r&&(s=l(this.attributes),t.each(this.associatedViews,function(i){t.each(r,function(n){a=m(this,n,s[n],t.extend({},this.attributes)),a?(e.invalid(i,n,a,e.selector),o=o||{},o[n]=a):e.valid(i,n,e.selector)},this)},this)),n===!0&&(o=this.validate()),o&&this.trigger("invalid",this,o,{validationError:o}),r?!o:this.validation?this._isValid:!0},validate:function(n,r){var a,s,o,d,h,F,f,m;return d=this,f=!n,h=t.extend({},e,r),m=c(d,u(e,i)),a=t.extend({},m,d.attributes,n),o=l(a),s=n?l(n):o,F=v(d,a,t.pick(o,t.keys(m))),d._isValid=F.isValid,t.each(d.associatedViews,function(i){t.each(m,function(t,e){var n,r;r=F.invalidAttrs.hasOwnProperty(e),n=s.hasOwnProperty(e),r||h.valid(i,e,h.selector),r&&(n||f)&&h.invalid(i,e,F.invalidAttrs[e],h.selector)})}),t.defer(function(){d.trigger("validated",d._isValid,d,F.invalidAttrs),d.trigger("validated:"+(d._isValid?"valid":"invalid"),d,F.invalidAttrs)}),!h.forceUpdate&&t.intersection(t.keys(F.invalidAttrs),t.keys(s)).length>0?F.invalidAttrs:void 0}}},i=function(i,e,n){e.associatedViews?e.associatedViews.push(i):e.associatedViews=[i],t.extend(e,F(i,n))},f=function(i,e){e&&i.associatedViews&&i.associatedViews.length>1?i.associatedViews=t.without(i.associatedViews,e):(delete i.validate,delete i.preValidate,delete i.isValid,delete i.associatedViews)},r=function(t){i(this.view,t,this.options)},a=function(t){f(t)},{version:"0.3.0",configure:function(i){t.extend(s,i)},bind:function(e,u){var o,l;if(u=t.extend({},s,n,u),l=u.model||e.model,o=u.collection||e.collection,"undefined"==typeof l&&"undefined"==typeof o)throw new Error("Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.");l?i(e,l,u):o&&(o.each(function(t){i(e,t,u)}),o.bind("add",r,{view:e,options:u}),o.bind("remove",a))},unbind:function(i,e){var n,s;e=t.extend({},e),s=e.model||i.model,n=e.collection||i.collection,s?f(s,i):n&&(n.each(function(t){f(t,i)}),n.unbind("add",r),n.unbind("remove",a))},mixin:F(null,s)}}(),n=i.callbacks={valid:function(t,i,e){t.$("["+e+'~="'+i+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(t,i,e,n){t.$("["+n+'~="'+i+'"]').addClass("invalid").attr("data-error",e)}},u=i.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},a=i.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",notEqualTo:"{0} must not be the same as {1}",validCollection:"{0} contains invalid entries: {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},r=i.labelFormatters={none:function(t){return t},sentenceCase:function(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,i){return 0===i?t.toUpperCase():" "+t.toLowerCase()}).replace(/_/g," ")},label:function(i,e){var n,r;return n=t.isFunction(e.labels)?e.labels.call(e):e.labels,r=Meshweaver.Validation.labelFormatters.sentenceCase,t.result(n,i)||r(i,e)}},e=i.attributeLoaders={inputNames:function(t){var i;return i=[],t.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===i.indexOf(this.name)&&i.push(this.name)}),i}},o=i.validators=function(){var i,e,n;return n=String.prototype.trim?function(t){return null===t?"":String.prototype.trim.call(t)}:function(t){var i,e;return i=/^\s+/,e=/\s+$/,null===t?"":t.toString().replace(i,"").replace(e,"")},e=function(i){return t.isNumber(i)||t.isString(i)&&i.match(u.number)},i=function(i){return null==i?!1:t.isString(i)&&!i?!1:t.isArray(i)&&t.isEmpty(i)?!1:!0},{fn:function(i,e,n,r,a,s){return t.isString(n)&&(n=r[n]),n.call(r,i,e,a,s)},required:function(e,n,r,s,u,o){var l;return l=t.isFunction(r)?r.call(s,e,n,u):r,l||i(e)?l&&!i(e)?this.format(o||a.required,this.formatLabel(n,s)):void 0:!1},acceptance:function(i,e,n,r,s,u){return"true"===i||t.isBoolean(i)&&i===!0?void 0:this.format(u||a.acceptance,this.formatLabel(e,r))},min:function(i,n,r,s,u,o){return r=t.isFunction(r)?r.call(s,i,n,u):r,e(i)&&i>=r?void 0:this.format(o||a.min,this.formatLabel(n,s),r)},max:function(i,n,r,s,u,o){return r=t.isFunction(r)?r.call(s,i,n,u):r,e(i)&&r>=i?void 0:this.format(o||a.max,this.formatLabel(n,s),r)},range:function(i,n,r,s,u,o){return r=t.isFunction(r)?r.call(s,i,n,u):r,e(i)&&i>=r[0]||i<=r[1]?void 0:this.format(o||a.range,this.formatLabel(n,s),r[0],r[1])},length:function(i,e,n,r,s,u){return n=t.isFunction(n)?n.call(r,i,e,s):n,t.isString(i)&&i.length===n?void 0:this.format(u||a.length,this.formatLabel(e,r),n)},minLength:function(i,e,n,r,s,u){return n=t.isFunction(n)?n.call(r,i,e,s):n,t.isString(i)&&i.length>=n?void 0:this.format(u||a.minLength,this.formatLabel(e,r),n)},maxLength:function(i,e,n,r,s,u){return n=t.isFunction(n)?n.call(r,i,e,s):n,t.isString(i)&&i.length<=n?void 0:this.format(u||a.maxLength,this.formatLabel(e,r),n)},rangeLength:function(i,e,n,r,s,u){return n=t.isFunction(n)?n.call(r,i,e,s):n,t.isString(i)&&i.length>=n[0]&&i.length<=n[1]?void 0:this.format(u||a.rangeLength,this.formatLabel(e,r),n[0],n[1])},oneOf:function(i,e,n,r,s,u){return t.include(n,i)?void 0:this.format(u||a.oneOf,this.formatLabel(e,r),n.join(", "))},equalTo:function(t,i,e,n,r,s){return t!==r[e]?(s||(s=a.equalTo),this.format(s,this.formatLabel(i,n),this.formatLabel(e,n))):void 0},notEqualTo:function(t,i,e,n,r,s){return t===r[e]?(s||(s=a.notEqualTo),this.format(s,this.formatLabel(i,n),this.formatLabel(e,n))):void 0},validCollection:function(i,e,n,r,s,u){var o,l,d;return d=t.isFunction(n)?n.call(r,i,e,s):n,d&&(l=i.filter(function(t){return!t.isNew()}).map(function(t){return t.validate()}),null!=t.find(l,function(t){return!!t}))?(o=t.chain(l.filter(function(t){return!!t})).map(function(i){return t.values(i)}).flatten().value().join("; "),this.format(u||a.validCollection,this.formatLabel(e,r),o)):void 0},pattern:function(e,n,r,s,o,l){return r=t.isFunction(r)?r.call(s,e,n,o):r,i(e)&&e.toString().match(u[r]||r)?void 0:(l||(l=a[r]||a.inlinePattern),this.format(l,this.formatLabel(n,s),r))}}}(),t.each(o,function(i,e){o[e]=t.bind(o[e],t.extend({},d,o))}),i}(_)}.call(this);
//# sourceMappingURL=meshweaver.min.js.map
